<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Live View - Intro to Postfix</title>
    <link rel="stylesheet" href="css/bot.css">
    <link rel="stylesheet" href="css/live-analytics.css"> 

</head>
<body>
    <div>
        <div class="page-header">
            <div class="page-header-content">
                <div>
                    <button class="btn btn-outline" onclick="window.history.back()">← Back to Sessions</button>
                    <h1 class="mt-2">Intro to Postfix <span class="week-number">Week 7</span></h1>
                </div>
                <div class="flex gap-2">
                    <button class="btn btn-outline btn-sm"
                            onclick="window.prompt('Link zum Kopieren:', 'student-feedback.html');">
                            <svg class="icon" viewBox="0 0 24 24" width="16" height="16"
                                stroke="currentColor" fill="none" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path>
                            </svg>
                        Session-Link
                    </button>
                    <button class="btn btn-outline btn-sm"
                            onclick="event.stopPropagation(); showQrCodeModal();">

                            <svg class="icon" viewBox="0 0 24 24" width="16" height="16"
                                stroke="currentColor" fill="none" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>

                        QR-Code
                    </button>
                    <button class="btn btn-destructive" onclick="confirmEndSessionLiveView()">
                        <svg class="icon" viewBox="0 0 24 24"
                            width="16" height="16"
                            stroke="currentColor" fill="none"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M15 9l-6 6M9 9l6 6"></path>
                        </svg>
                        Close Session
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="live-sec">
                <div class="live-indicator">
                    <div class="live-dot"></div> Live View
                </div>
                <div>
                    <span id="response-count">18</span> responses received
                </div>
            </div>

            <div class="analytics-card">
                <h3>1. How well did you understand today's content?</h3>
                <div class="avg-score">★ 3.5 Average</div>
                
                <div class="chart-container">
                    <div class="chart-bar-wrapper"><div class="bar-value">2</div><div class="chart-bar filled" style="height: 10%;"></div><div class="bar-label">1</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">4</div><div class="chart-bar filled" style="height: 20%;"></div><div class="bar-label">2</div></div>
                    
                    <div class="chart-bar-wrapper">
                        <div class="bar-value" id="val-q1-3">8</div>
                        <div class="chart-bar filled" id="bar-q1-3" style="height: 40%;"></div>
                        <div class="bar-label">3</div>
                    </div>

                    <div class="chart-bar-wrapper"><div class="bar-value">3</div><div class="chart-bar filled" style="height: 15%;"></div><div class="bar-label">4</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">1</div><div class="chart-bar filled" style="height: 5%;"></div><div class="bar-label">5</div></div>
                </div>
            </div>

            <div class="analytics-card">
                <h3>2. How was the pace of the lecture?</h3>
                <div class="avg-score">★ 4.2 Average</div>
                
                <div class="chart-container">
                    <div class="chart-bar-wrapper"><div class="bar-value">0</div><div class="chart-bar filled" style="height: 2%;"></div><div class="bar-label">Too Slow</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">2</div><div class="chart-bar filled" style="height: 10%;"></div><div class="bar-label">Slow</div></div>
                    
                    <div class="chart-bar-wrapper">
                        <div class="bar-value" id="val-q2-3">12</div>
                        <div class="chart-bar filled" id="bar-q2-3" style="height: 60%;"></div>
                        <div class="bar-label">Perfect</div>
                    </div>

                    <div class="chart-bar-wrapper"><div class="bar-value">4</div><div class="chart-bar filled" style="height: 20%;"></div><div class="bar-label">Fast</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">0</div><div class="chart-bar filled" style="height: 2%;"></div><div class="bar-label">Too Fast</div></div>
                </div>
            </div>

            <div class="analytics-card">
                <h3>3. What was the most confusing topic today?</h3>
                <p class="text-sm text-muted-foreground mb-2">18 responses</p>

                <div class="text-response-list" id="text-list">
                    <div class="text-response-item">The concept of pointers is still tricky.</div>
                    <div class="text-response-item">Why do we need manual memory management?</div>
                    <div class="text-response-item hidden-new" style="display:none">Stack vs Heap usage example please!</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function confirmEndSessionLiveView() {
            const modal = document.createElement('div');

            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.right = '0';
            modal.style.bottom = '0';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '1000';

            modal.onclick = (e) => {
                if (e.target === modal) document.body.removeChild(modal);
            };

            modal.innerHTML = `
                <div style="background: white; border-radius: 0.75rem; width: 90%; max-width: 520px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); overflow: hidden;" onclick="event.stopPropagation()">
                    <div style="padding: 1.5rem; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">
                        <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0;">End session?</h3>
                        <p style="color: rgba(113, 113, 130, 1); font-size: 0.875rem; margin-top: 0.25rem; margin-bottom: 0;">Ending the session is final. Students can no longer submit feedback.</p>
                    </div>
                    <div style="padding: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end;">
                        <button type="button" class="btn btn-outline" onclick="document.body.removeChild(this.closest('[data-live-end-session-modal]'))">Cancel</button>
                        <button type="button" class="btn btn-destructive" onclick="endSessionLiveViewConfirmed(this)">Yes, close session</button>
                    </div>
                </div>
            `;

            modal.setAttribute('data-live-end-session-modal', 'true');
            document.body.appendChild(modal);
        }

        function endSessionLiveViewConfirmed(buttonEl) {
            const modal = buttonEl.closest('[data-live-end-session-modal]');
            if (modal) document.body.removeChild(modal);
            window.location.href = 'session-analytics.html';
        }

        setTimeout(() => {
            document.getElementById('response-count').innerText = "19";
            
            document.getElementById('bar-q1-3').style.height = "45%"; 
            document.getElementById('bar-q2-3').style.height = "65%"; 
            
            document.getElementById('val-q1-3').innerText = "9";
            document.getElementById('val-q2-3').innerText = "13";
            
            const newItem = document.querySelector('.hidden-new');
            newItem.style.display = 'block';
            newItem.style.animation = 'fadeIn 0.5s';

        }, 2000);
    </script>

    <div id="page-guide-container">
    
        <div id="guide-popup" class="guide-popup hidden">
            <div class="popup-header">
                <h4 id="popup-title">Page Info</h4>
                <button onclick="toggleGuide()" class="close-btn">&times;</button>
            </div>
            <div class="popup-content">
                <p id="popup-description">Loading info...</p>
                <div class="popup-tips">
                    <strong>Tip:</strong> <span id="popup-tip">Click elements to interact.</span>
                </div>
            </div>
        </div>

        <div id="guide-bot" class="guide-bot" onclick="toggleGuide()">
            <div class="bot-antenna">
                <div class="antenna-ball"></div>
            </div>
            <div class="bot-head">
                <div class="bot-face">
                    <div class="eye left"></div>
                    <div class="eye right"></div>
                </div>
                <div class="bot-cheek left"></div>
                <div class="bot-cheek right"></div>
            </div>
            <div class="bot-body-shape">
                <div class="bot-detail"></div>
            </div>
        </div>

    </div>

    <script src="js/bot.js"></script>
    <script src="js/course_view.js"></script>
</body>
</html>