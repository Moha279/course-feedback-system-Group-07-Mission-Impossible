<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>Analytics - Intro to Postfix</title>
    <link rel="stylesheet" href="css/live-analytics.css">

</head>

<body>

    <div>
        <div class="page-header">
            <div class="page-header-content">
                <div>
                    <button class="btn btn-outline" onclick="window.history.back()">← Back to Sessions</button>
                    <h1 class="mt-2">Intro to Postfix <span class="week-number">Week 7 • Closed</span></h1>
                </div>
                <div class="flex gap-2">
                    <button class="btn btn-outline">Export Data</button>
                    <button class="btn btn-success" onclick="window.location.href='live-feedback.html'">
                        Reopen Session
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            
            <div class="analytics-card">
                <h3>1. How well did you understand today's content?</h3>
                <div class="avg-score">★ 3.5 Average</div>
                <div class="chart-container">
                    <div class="chart-bar-wrapper"><div class="bar-value">2</div><div class="chart-bar filled" style="height: 10%;"></div><div class="bar-label">1</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">4</div><div class="chart-bar filled" style="height: 20%;"></div><div class="bar-label">2</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">9</div><div class="chart-bar filled" style="height: 45%;"></div><div class="bar-label">3</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">3</div><div class="chart-bar filled" style="height: 15%;"></div><div class="bar-label">4</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">1</div><div class="chart-bar filled" style="height: 5%;"></div><div class="bar-label">5</div></div>
                </div>
            </div>

            <div class="analytics-card">
                <h3>2. How was the pace of the lecture?</h3>
                <div class="avg-score">★ 4.2 Average</div>
                <div class="chart-container">
                    <div class="chart-bar-wrapper"><div class="bar-value">0</div><div class="chart-bar filled" style="height: 2%;"></div><div class="bar-label">Too Slow</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">2</div><div class="chart-bar filled" style="height: 10%;"></div><div class="bar-label">Slow</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">13</div><div class="chart-bar filled" style="height: 65%;"></div><div class="bar-label">Perfect</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">4</div><div class="chart-bar filled" style="height: 20%;"></div><div class="bar-label">Fast</div></div>
                    <div class="chart-bar-wrapper"><div class="bar-value">0</div><div class="chart-bar filled" style="height: 2%;"></div><div class="bar-label">Too Fast</div></div>
                </div>
            </div>

            <div class="analytics-card">
                <div class="flex justify-between items-center mb-4">
                    <h3>3. What was the most confusing topic today?</h3>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <button class="btn btn-outline btn-sm" id="ai-summary-btn" onclick="generateAISummary();">Generate AI Summary</button>
                        <small id="ai-summary-hint" style="font-size: 0.75rem; color: var(--muted-foreground); display: none;">Close the session to generate an AI summary.</small>
                    </div>
                </div>

                <div class="keyword-cloud">
                    <span class="keyword" data-keyword="pointers" onclick="filterByKeyword('pointers')">Pointers (8)</span>
                    <span class="keyword" data-keyword="memory" onclick="filterByKeyword('memory')">Memory (5)</span>
                    <span class="keyword" data-keyword="stack" onclick="filterByKeyword('stack')">Stack (3)</span>
                    <span class="keyword" data-keyword="syntax" onclick="filterByKeyword('syntax')">Syntax (2)</span>
                </div>

                <p id="keyword-hint" style="font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 1rem; display: none;">Select a keyword to emphasize related feedback.</p>

                <div class="text-response-list" id="text-response-list">
                    <div class="text-response-item" data-topics="pointers memory">The concept of pointers is still tricky.</div>
                    <div class="text-response-item" data-topics="memory">Why do we need manual memory management?</div>
                    <div class="text-response-item" data-topics="stack memory">I'm having trouble understanding the difference between the stack and the heap.</div>
                    <div class="text-response-item" data-topics="syntax">Syntax for pointers * and & is confusing.</div>
                </div>
            </div>

        </div>
    </div> 
    <script>
        function getSessionStatus() {
            // Simulated: read from URL or storage; here we assume 'Closed' if header contains 'Closed'
            const header = document.querySelector('.week-number');
            return header && header.textContent.includes('Closed') ? 'closed' : 'open';
        }

        function updateAISummaryButton() {
            const button = document.getElementById('ai-summary-btn');
            const hint = document.getElementById('ai-summary-hint');
            if (!button || !hint) return;
            const status = getSessionStatus();
            if (status === 'closed') {
                button.disabled = false;
                button.title = '';
                hint.style.display = 'none';
            } else {
                button.disabled = true;
                button.title = 'Close the session to generate an AI-based summary of the feedback.';
                hint.style.display = 'inline';
            }
        }

        function generateAISummary() {
            const status = getSessionStatus();
            if (status === 'open') return;

            let overlay = document.getElementById('ai-summary-overlay');
            if (overlay) {
                document.body.removeChild(overlay);
                return;
            }

            overlay = document.createElement('div');
            overlay.id = 'ai-summary-overlay';
            overlay.className = 'modal-overlay';
            overlay.onclick = (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            };

            overlay.innerHTML = `
                <div class="modal" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">AI Summary</h3>
                        <button onclick="document.getElementById('ai-summary-overlay').remove()" style="background:none;border:none;color:var(--muted-foreground);cursor:pointer;font-size:1.5rem;line-height:1;">&times;</button>
                    </div>
                    <div class="modal-content">
                        <p id="ai-summary-desc" class="modal-description">AI is analyzing student feedback…</p>
                        <div id="ai-summary-body" style="text-align: center; padding: 2rem 0;">
                            <div style="display: inline-block; width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            setTimeout(() => {
                const summaries = [
                    `Students appreciate the clear examples and practical pace. A few suggest more interactive problem-solving sessions and slightly slower coverage of complex proofs.`,
                    `Overall sentiment is positive. Learners find the content engaging but request additional optional exercises for deeper practice.`,
                    `Feedback highlights enthusiasm for real-world applications. Some students feel the theoretical sections are dense and ask for supplementary visual summaries.`,
                    `The majority enjoy the logical flow and quizzes. Minor requests include more office hours and clearer rubrics for assignments.`,
                    `Learners value the structured slides and step-by-step explanations. A recurring theme is the desire for more worked examples before independent practice.`
                ];
                const randomSummary = summaries[Math.floor(Math.random() * summaries.length)];

                document.getElementById('ai-summary-desc').textContent = 'AI-generated summary of student feedback';
                document.getElementById('ai-summary-body').innerHTML = `
                    <div style="background: var(--secondary); padding: 1rem; border-radius: 0.375rem; border-left: 4px solid var(--primary); text-align: left;">
                        <p style="font-size: 0.875rem; color: var(--foreground); line-height: 1.6; white-space: pre-wrap; margin: 0;">${randomSummary}</p>
                    </div>
                `;
            }, 1800);
        }

        function filterByKeyword(keyword) {
            const items = document.querySelectorAll('.text-response-item');
            const hint = document.getElementById('keyword-hint');
            const keywords = document.querySelectorAll('.keyword');
            
            // Reset all keywords and items
            keywords.forEach(k => {
                k.style.backgroundColor = 'white';
                k.style.color = 'var(--foreground)';
            });
            items.forEach(item => {
                item.style.backgroundColor = 'var(--accent)';
                item.style.border = '1px solid var(--border)';
                item.style.opacity = '1';
            });
            
            // If clicking the same active keyword, reset
            if (window.activeKeyword === keyword) {
                window.activeKeyword = null;
                hint.style.display = 'none';
                return;
            }
            
            // Set new active keyword
            window.activeKeyword = keyword;
            const activeKeywordEl = document.querySelector(`[data-keyword="${keyword}"]`);
            activeKeywordEl.style.backgroundColor = 'var(--primary)';
            activeKeywordEl.style.color = 'white';
            
            // Emphasize matching items, dim others
            let hasMatch = false;
            items.forEach(item => {
                const topics = item.getAttribute('data-topics').split(' ');
                if (topics.includes(keyword)) {
                    item.style.backgroundColor = '#f0fdf4';
                    item.style.border = '1px solid #bbf7d0';
                    item.style.opacity = '1';
                    hasMatch = true;
                } else {
                    item.style.opacity = '0.4';
                }
            });
            
            hint.style.display = hasMatch ? 'none' : 'block';
        }

        document.addEventListener('DOMContentLoaded', updateAISummaryButton);
    </script>
</body>

</html>